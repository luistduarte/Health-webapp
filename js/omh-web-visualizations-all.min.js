!function(t,e){var a="OMHWebVisualizations";t[a]=e(t,a)}(this,function(t,e){var a,n=t.hasOwnProperty(e)?t[e]:{};return a=function(t,e,a,n){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]),e.node||(e=d3.select(e)),n||(n={}),e.classed("omh-chart-container",!0);var i,r=a.split(/\s*,\s*/),o=null,s=new OMHWebVisualizations.ChartConfiguration(n),l=new OMHWebVisualizations.DataParser(t,r,s),u=new OMHWebVisualizations.ChartStyles(s),c=new OMHWebVisualizations.ChartInteractions(e,r[0],s,l,u);this.initialized=!1;var f=new Plottable.Scales.Time,d=new Plottable.Scales.Linear,g=null,m=s.getMeasureSettings(r[0]).yAxis.range;m&&d.domainMin(m.min).domainMax(m.max);var h=new Plottable.Axes.Time(f,"bottom").margin(15).addClass("x-axis"),p=new Plottable.Axes.Numeric(d,"left"),y=new Plottable.Components.AxisLabel(s.getMeasureSettings(r[0]).yAxis.label,"0").padding(5).xAlignment("right").yAlignment("top"),v=[],b=(new Plottable.Plots.Scatter).x(function(t){return t.x},f).y(function(t){return t.y},d);u.setStylesForPlot(u.getConfiguredDefaultStylesForPlot(b),b);var x=[],P=0,D=[];d3.entries(l.getAllMeasureData()).forEach(function(t){var e=t.key;"clustered_bar"===s.getMeasureSettings(e).chart.type&&P++});var S,A,T=[];if(r.forEach(function(t){var e=s.getMeasureSettings(t);if(e.chart&&e.chart.gridlines){var a=e.chart.gridlines;a.forEach(function(t){t.hasOwnProperty("visible")&&t.visible!==!0||T.push(t)})}}),T.length>0){T.sort(function(t,e){return t.value-e.value});var _=new Plottable.Scales.Linear;_.domain(d.domain()),_.range(d.range()),g=function(t){_.domain(t.domain()),_.range(t.range())},d.onUpdate(g);var M=function(t){var e=T.map(function(t){return t.value});return e};_.tickGenerator(M),A=new Plottable.Axes.Numeric(_,"right").tickLabelPosition("top").tickLabelPadding(1).showEndTickLabels(!0).addClass("gridlines-axis"),A.formatter(function(t){for(var e in T)if(T[e].value===t){var a=T[e].label?T[e].label:T[e].value;return String(a)}}),S=new Plottable.Components.Gridlines(null,_),v.push(S),v.push(A)}r.forEach(function(t){if(l.hasMeasureData(t)){var e=l.getMeasureData(t),a=new Plottable.Dataset(e),n=s.getMeasureSettings(t);if(a.measure=t,"clustered_bar"===n.chart.type){var i=d;if(x.length>0){var r=n.yAxis.range,o=n.yAxis.label;i=(new Plottable.Scales.Linear).domainMin(r.min).domainMax(r.max);var c=new Plottable.Axes.Numeric(i,"right"),g=new Plottable.Components.AxisLabel(o,"0").padding(5).xAlignment("left").yAlignment("top");D.push({measure:t,axis:c,label:g,scale:i})}var m=(new Plottable.Plots.ClusteredBar).x(function(t){return t.x},f).y(function(t){return t.y},i);u.setStylesForPlot(u.getConfiguredDefaultStylesForPlot(m),m),x.push(m);for(var p=0;p<P;p++)p===x.length-1?m.addDataset(a):m.addDataset(new Plottable.Dataset([]));var y=h.axisConfigurations(),S=[];y.forEach(function(t){"day"!==t[0].interval&&"month"!==t[0].interval&&"year"!==t[0].interval||S.push(t)}),h.axisConfigurations(S),m.addClass("clustered-bar-plot-"+t),v.push(m)}else{var A=(new Plottable.Plots.Line).x(function(t){return t.x},f).y(function(t){return t.y},d);u.setStylesForPlot(u.getConfiguredDefaultStylesForPlot(A),A),A.addDataset(a),b.addDataset(a),A.addClass("line-plot-"+t),v.push(A)}}}),b.addClass("point-plot"),v.push(b);var w=null,C=null,E=s.getInterfaceSettings().legend;if(E&&E.visible){w=new Plottable.Scales.Color,C=new Plottable.Components.Legend(w);var N=[],O=[];d3.entries(l.getAllMeasureData()).forEach(function(t){var e=t.key,a=s.getMeasureSettings(e),n=a.legend.seriesName,i=a.legend.seriesColor;n&&i&&(N.push(n),O.push(i))}),w.domain(N),w.range(O),C.maxEntriesPerRow(2),C.symbol(Plottable.SymbolFactories.square),C.xAlignment("right"),C.yAlignment("top"),v.push(C)}var I=s.getInterfaceSettings().axes.xAxis.visible,z=s.getInterfaceSettings().axes.yAxis.visible,F=new Plottable.Components.Group(v),V=z?new Plottable.Components.Group([p,y]):null,U=[V,F],H=[null,I?h:null];z&&D.forEach(function(t){U.push(new Plottable.Components.Group([t.axis,t.label])),H.push(null)}),o=new Plottable.Components.Table([U,H]),o.yAlignment("bottom"),c.addToComponents({plots:v,plotGroup:F,table:o,xScale:f,xAxis:h}),this.destroy=function(){c.destroy(),o&&o.destroy(),g&&d.offUpdate(g)},this.getComponents=function(){if(!this.initialized)return{};var t={};t[r[0]]=d;var e={};e[r[0]]=p;var a={};a[r[0]]=y;var n={};n[r[0]]=f;var i={};i[r[0]]=h;var s={};return s[r[0]]=w,D.forEach(function(n){t[n.measure]=n.scale,e[n.measure]=n.axis,a[n.measure]=n.label}),{xScales:n,yScales:t,colorScales:s,gridlines:{gridlines:S,yAxis:A,values:T},legends:[C],xAxes:i,yAxes:e,plots:v,yLabels:a,table:o,tooltip:c.getTooltip(),toolbar:c.getToolbar(),panZoomInteractions:{plotGroup:c.getPanZoomInteraction(),xAxis:c.getpanZoomInteractionXAxis()}}},this.getPlots=function(t){return t?v.filter(function(e){return e instanceof t}):v},this.addGridline=function(t,e){T.push({value:t,label:e?e:t})},this.getMeasures=function(){return r},this.getStyles=function(){return u},this.getInteractions=function(){return c},this.getConfiguration=function(){return s},this.getParser=function(){return l},this.getD3Selection=function(){return i},this.renderTo=function(t){return this.initialized?(i=d3.select(t),c.addToSelection(i),o.renderTo(i),u.addToSelection(i),void c.addTooltipsToEntities(b.entities())):void console.log("Warning: chart could not be rendered because it was not successfully initialized.")},this.initialized=!0},n.Chart=a,n}),function(t,e){var a="OMHWebVisualizations";t[a]=e(t,a)}(this,function(t,e){var a,n=t.hasOwnProperty(e)?t[e]:{};return a=function(t){var e,a,i={"interface":{toolbar:{visible:!0,timespanButtons:{visible:!0},zoomButtons:{visible:!0},navigationButtons:{visible:!0}},tooltips:{visible:!0,timeFormat:"M/D/YY, h:mma",decimalPlaces:0,contentFormatter:n.ChartStyles.formatters.defaultTooltip.bind(this),grouped:!0},panZoomUsingMouse:{enabled:!0,hint:{visible:!0}},axes:{yAxis:{visible:!0},xAxis:{visible:!0}}},measures:{body_weight:{data:{yValuePath:"body.body_weight.value"},yAxis:{range:{min:0,max:100},label:"kg"}},heart_rate:{data:{yValuePath:"body.heart_rate.value"},yAxis:{range:{min:30,max:150},label:"bpm"}},step_count:{data:{yValuePath:"body.step_count",xValueQuantization:{period:n.DataParser.QUANTIZE_DAY,aggregator:n.DataParser.aggregators.sum}},chart:{type:"clustered_bar",daysShownOnTimeline:{min:7,max:90}},legend:{seriesName:"Steps",seriesColor:"#eeeeee"},yAxis:{range:{min:0,max:1500},label:"Steps"}},minutes_moderate_activity:{data:{yValuePath:"body.minutes_moderate_activity.value",xValueQuantization:{period:n.DataParser.QUANTIZE_DAY,aggregator:n.DataParser.aggregators.sum}},chart:{type:"clustered_bar",daysShownOnTimeline:{min:7,max:90}},legend:{seriesName:"Minutes of moderate activity",seriesColor:"#4a90e2"},yAxis:{range:{min:0,max:300},label:"Minutes"}},systolic_blood_pressure:{data:{yValuePath:"body.systolic_blood_pressure.value"},yAxis:{range:{min:30,max:200},label:"mmHg"}},diastolic_blood_pressure:{data:{yValuePath:"body.diastolic_blood_pressure.value"},yAxis:{range:{min:30,max:200},label:"mmHg"}}}},r={yAxis:{range:{min:0,max:100},label:"Units"},data:{xValueQuantization:{period:n.DataParser.QUANTIZE_NONE,aggregator:n.DataParser.aggregators.mean}},chart:{type:"line",daysShownOnTimeline:{min:1,max:1e3}},legend:{seriesName:"Series",seriesColor:"#4a90e2"}},o=function(){e=n.Utils.mergeObjects(i,t),a=Object.keys(e.measures),a.forEach(function(t){e.measures[t]=n.Utils.mergeObjects(r,e.measures[t])})};this.getConfiguredMeasureNames=function(){return Object.keys(e.measures)},this.getMeasureSettings=function(t){return e.measures[t]},this.getInterfaceSettings=function(){return e["interface"]},o.call(this)},n.ChartConfiguration=a,n}),function(t,e){var a="OMHWebVisualizations";t[a]=e(t,a)}(this,function(t,e){var a,n=t.hasOwnProperty(e)?t[e]:{};return a=function(t,e,a,n,i){var r,o,s,l,u,c,f,d,g,m,h,p,y,v,b,x,P,D,S,A,T=864e5,_=a.getInterfaceSettings(),M={},w={},C=function(t){d&&(t=Math.max(t,d)),g&&(t=Math.min(t,g));var e=m.domain(),a=[e[0],new Date(e[0].getTime()+t*T)];m.domain(a)},E=function(t){return(t[1].getTime()-t[0].getTime())/T},N=function(t){var e=m.domain(),a=E(e);a*=(100-t)/100,d&&(a=Math.max(a,d)),g&&(a=Math.min(a,g));var n=[e[0],new Date(e[0].getTime()+a*T)];m.domain(n)},O=function(t){var e=m.domain(),a=E(e);a*=t/100;var n=[new Date(e[0].getTime()+a*T),new Date(e[1].getTime()+a*T)];m.domain(n)},I=function(){d3.selectAll(".time-button").classed("active",!1)},z=function(t){y=new Plottable.Interactions.Pointer,y.onPointerExit(function(t){v.hide()}),y.onPointerEnter(x.bind(this)),P=function(e){var a;try{a=t.entityNearest(e),b(a),x()}catch(n){return}},y.onPointerMove(P),y.attachTo(t),D=t},F=function(t){c=new Plottable.Interactions.PanZoom,f=new Plottable.Interactions.PanZoom,c.addXScale(t.xScale),c.attachTo(t.plotGroup),f.addXScale(t.xScale),f.attachTo(t.xAxis),d&&(c.minDomainExtent(t.xScale,d*T),f.minDomainExtent(t.xScale,d*T)),g&&(c.maxDomainExtent(t.xScale,g*T),f.maxDomainExtent(t.xScale,g*T))},V=function(t){var e=[];d3.entries(n.getAllMeasureData()).forEach(function(t){var a=t.value;a.forEach(function(t){e.push(t.x)})});var a=t.extentOfValues(e),i=a[1].getTime()-a[0].getTime(),r=g*T;i>r&&(a[1]=new Date(a[0].getTime()+r)),t.domain(a)},U=function(){r=new Plottable.Interactions.Drag,o=function(){p&&p(),v&&x&&x()},r.onDrag(o)},H=function(){s=function(){x&&x(),I&&I(),p&&p()}},Z=function(){u=new Plottable.Components.Label("( Drag chart to pan, pinch or scroll to zoom )",0).padding(10).yAlignment("bottom").xAlignment("right").addClass("zoom-hint-label"),p=function(){u.addClass("hidden")};var t=((new Plottable.Interactions.Click).attachTo(u).onClick(function(t){p()}),a.getMeasureSettings(e).chart.daysShownOnTimeline);d=!!t&&t.min,g=!!t&&t.max},Q=function(){if(_.toolbar.visible){if(h=t.append("div").classed("omh-chart-toolbar",!0).attr("unselectable","on"),_.toolbar.timespanButtons.visible){var e={"1wk":7,"1m":30,"3m":90,"6m":180};h.append("span").classed("time-buttons-label",!0).text("Show: "),d3.entries(e).forEach(function(t){var e=t.value,a=t.key;if((!g||e<=g)&&(!d||e>=d)){var n=h.append("span").classed("time-button",!0).text(a);n.on("click",function(){I(),C(e),d3.select(this).classed("active",!0)})}})}if(_.toolbar.zoomButtons.visible){var a={"&#8722;":-20,"&#43;":20};h.append("span").classed("zoom-buttons-label",!0).text(" Zoom: "),d3.entries(a).forEach(function(t){var e=t.value,a=t.key,n=h.append("span").classed("zoom-button",!0).html(a);n.on("click",function(){I(),N(e)})})}if(_.toolbar.navigationButtons.visible){var n=h.append("span",":first-child").classed("previous-time-period-button",!0).text("< prev");n.on("click",function(){O(-100)});var i=h.append("span").classed("next-time-period-button",!0).text("next >");i.on("click",function(){O(100)})}}},W=function(){if(_.tooltips.visible){var t=null,e=null,a=function(t){e=t.selection.style("opacity"),t.selection.style("opacity","1")},n=function(t){t.selection.style("opacity",e)},r=function(t,e){w[t][e].forEach(function(t){a(t)})},o=function(t,e){w[t][e].forEach(function(t){n(t)})},s=function(t){v.show(t.datum,t.selection[0][0])},l=function(t){t&&A&&(t.selection[0][0].getBoundingClientRect().left>A[0][0].getBoundingClientRect().left&&t.selection[0][0].getBoundingClientRect().right<A[0][0].getBoundingClientRect().right?s(t):v.hide())};x=function(){if(t&&A)if(t.datum.primary||!_.tooltips.grouped)l(t);else{var e=M[t.datum.omhDatum.groupName][t.index],a=d3.select(".d3-tip").node().clientHeight;l(e.selection[0][0].getBoundingClientRect().top>A[0][0].getBoundingClientRect().top+a?e:t)}},b=function(e){if(null!==t){var a=_.tooltips.grouped,n=e.datum.omhDatum.body!==t.datum.omhDatum.body,i=e.datum.measure!==t.datum.measure,s=a?n:n||i;s&&(o(t.datum.omhDatum.groupName,t.index),t=e,r(t.datum.omhDatum.groupName,e.index))}else t=e;null===e.datum};var u=function(t){var e;if(_.tooltips&&"undefined"!=typeof _.tooltips.contentFormatter)e=_.tooltips.contentFormatter(t);else{var a="undefined"!=typeof _.decimalPlaces?_.decimalPlaces:1;e=t.y.toFixed(a)}var n='<div class="value">'+e+"</div>",i=_.tooltips.timeFormat;return n+='<div class="time">'+moment(t.x).format(i)+"</div>",n+='<div class="provider">'+t.provider+"</div>"};v=d3.tip().attr("class","d3-tip").html(function(e){var a=t.component,n=i.resolveStyleNameForDatumInPlot(e,a);n=n.toLowerCase().replace(/[^a-z0-9]+/g,"_");var r=e.measure+" "+n;return'<div class="omh-tooltip '+r+'">'+u(e)+"</div>"})}},k=function(){U(),H(),Z(),Q(),W()};this.getTooltip=function(){return v},this.getToolbar=function(){return h},this.getPanZoomInteraction=function(){return c},this.getpanZoomInteractionXAxis=function(){return f},this.addToComponents=function(t){if(_.tooltips.visible)for(var e in t.plots){var a=t.plots[e];if(a instanceof Plottable.Plots.Scatter&&a.datasets()&&a.datasets().length>0){z(a);break}}g&&V(t.xScale),_.panZoomUsingMouse.enabled&&(F(t),_.panZoomUsingMouse.hint.visible&&t.plotGroup.append(u),r.attachTo(t.table)),S=t.table,m=t.xScale},this.addToSelection=function(t){A=t,l&&l.offWheel(s),l=new Plottable.Dispatchers.Mouse.getDispatcher(A[0][0]).onWheel(s),v&&A.call(v)},this.addTooltipsToEntities=function(t){M={},w={},t.forEach(function(t){var e=t.datum.omhDatum.groupName;M[e]||(M[e]=[]),t.datum.primary&&(M[e][t.index]=t),w[e]||(w[e]=[]),w[e][t.index]||(w[e][t.index]=[]),w[e][t.index].push(t)})},this.destroy=function(){y&&y.offPointerMove(P),y&&y.detachFrom(D),r&&r.detachFrom(S),v&&v.destroy(),l&&l.offWheel(s),x&&r.offDrag(x),h&&h.remove()},k.call(this)},n.ChartInteractions=a,n}),function(t,e){var a="OMHWebVisualizations";t[a]=e(t,a)}(this,function(root,parentName){var parent=root.hasOwnProperty(parentName)?root[parentName]:{},ChartStyles;ChartStyles=function(configuration){var plotStyles=[],getPointThresholds=function(t){return configuration.getMeasureSettings(t.measure).thresholds};this.getConfiguredStylesForPlot=function(plot){var measures=configuration.getConfiguredMeasureNames(),styles=[];return measures.forEach(function(measure){var measureSettings=configuration.getMeasureSettings(measure);if(measureSettings.chart&&measureSettings.chart.styles){var measureStyles=measureSettings.chart.styles;measureStyles.forEach(function(style){var plotClass=eval("Plottable.Plots."+style.plotType);if(plot instanceof plotClass){var measureFilter=function(t){return t.measure===measure},newStyle={name:style.name,filters:[measureFilter],attributes:style.attributes};style.filters&&style.filters.forEach(function(t){newStyle.filters.push(t)}),styles.push(newStyle)}})}}),styles},this.getConfiguredDefaultStylesForPlot=function(t){var e=ChartStyles.getDefaultStylesForPlot(t),a=this.getConfiguredStylesForPlot(t);return e.concat(a)},this.applyFilters=function(t,e){for(j=0;j<t.length;j++)if(!t[j](e))return!1;return!0},this.getAttributeValueAccessor=function(t,e){return function(a){var n=this.resolveAttributeValue(t,a);return n?n:e(a)}.bind(this)},this.getStylesKeyedByAttributeName=function(t){var e={};return t.forEach(function(t){var a=Object.getOwnPropertyNames(t.attributes);a.forEach(function(a){e[a]||(e[a]=[]);var n={};n.value=t.attributes[a],t.filters&&(n.filters=t.filters),e[a].push(n)})}),e},this.getFilteredProperty=function(t,e,a){for(i=a.length-1;i>=0;i--){var n=a[i].filters,r=a[i][e];if(!n)return r;if(this.applyFilters(n,t))return r}return null},this.resolveAttributeValue=function(t,e){return this.getFilteredProperty(e,"value",t)},this.getStylesForPlot=function(t){for(var e in plotStyles)if(plotStyles[e].plot===t)return plotStyles[e].styles},this.setStylesForPlot=function(t,e){var a=this.getStylesForPlot(e);a?a.styles=t:plotStyles.push({plot:e,styles:t}),this.assignAttributesToPlot(t,e)},this.resolveStyleNameForDatumInPlot=function(t,e){var a=this.getStylesForPlot(e);return a?this.getFilteredProperty(t,"name",a):null},this.assignAttributesToPlot=function(t,e){var a=this.getStylesKeyedByAttributeName(t);for(var n in a)"size"===n?(defaultAccessor=e.size()?e.size().accessor:null,e.size(this.getAttributeValueAccessor(a[n],defaultAccessor))):(defaultAccessor=e.attr(n)?e.attr(n).accessor:null,e.attr(n,this.getAttributeValueAccessor(a[n],defaultAccessor)))},this.addToSelection=function(t){var e=t.select("defs")[0][0];e=e?d3.select(e):t.append("defs");var a=e.select("#y-axis-label-gradient")[0][0];a||(a=e.append("linearGradient").attr("id","y-axis-label-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad"),a.append("stop").attr("offset","0%").attr("stop-color","#fff").attr("stop-opacity",1),a.append("stop").attr("offset","75%").attr("stop-color","#fff").attr("stop-opacity",1),a.append("stop").attr("offset","100%").attr("stop-color","#fff").attr("stop-opacity",0))}};var formatters={};return ChartStyles.formatters=formatters,ChartStyles.formatters.defaultTooltip=function(t){var e;if("_systolic_blood_pressure_diastolic_blood_pressure"===t.omhDatum.groupName){var a=t.omhDatum.body.systolic_blood_pressure.value.toFixed(0),n=t.omhDatum.body.diastolic_blood_pressure.value.toFixed(0);e=a+"/"+n}else{var i=this.getInterfaceSettings().tooltips,r="undefined"!=typeof i.decimalPlaces?i.decimalPlaces:1;e=t.y.toFixed(r)}return e},ChartStyles.getDefaultStylesForPlot=function(plot){var defaults={Scatter:[{name:"default",attributes:{fill:"#4a90e2",stroke:"#0066d6","stroke-width":"1px",size:9,opacity:.5}}],Line:[{name:"default",attributes:{stroke:"#dedede","stroke-width":"1px"}}],ClusteredBar:[{name:"default",attributes:{fill:"#4a90e2"}},{name:"secondary",filters:[function(t){return!t.primary}],attributes:{fill:"#eeeeee"}}]},defaultStyleForPlot=null;for(var plotType in defaults){var plotClass=eval("Plottable.Plots."+plotType);plot instanceof plotClass&&(defaultStyleForPlot=defaults[plotType])}return defaultStyleForPlot?defaultStyleForPlot:[]},ChartStyles.filters={measure:function(t){return function(e){return e.measure===t}},above:function(t){return function(e){return e.y>t}},below:function(t){return function(e){return e.y<t}},dailyBeforeHour:function(t){return function(e){return e.x.getHours()<t}}},parent.ChartStyles=ChartStyles,parent}),function(t,e){var a="OMHWebVisualizations";t[a]=e(t,a)}(this,function(t,e){var a,n=t.hasOwnProperty(e)?t[e]:{};return a=function(t,e,a){var n=null,i={},r={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},o=function(){var a=JSON.parse(JSON.stringify(t)),i="undefined"!=typeof moment?moment:Date;if(n=this.parseOmhData(a,e,i),0===Object.keys(n).length)return console.log("Warning: no data of the specified type could be found."),!1};return this.resolveKeyPath=function(t,e){if(void 0===t)return t;var a;"string"==typeof e?(i[e]||(i[e]=e.split(".")),a=i[e].slice()):a=e;try{if(e&&a.length>0)return this.resolveKeyPath(t[a.shift()],a)}catch(n){console.info("Exception while resolving keypath",n)}return t},this.getIntervalDisplayDate=function(t,e){var a=t.body.effective_time_frame.time_interval,n=a.start_date_time?new Date(a.start_date_time).getTime():null,i=a.end_date_time?new Date(a.end_date_time).getTime():null,o=a.start_date_time?e(a.start_date_time):null,s=a.end_date_time?e(a.end_date_time):null,l=a.duration?a.duration.value:null;if(l){var u,c=a.duration.unit,f=r[c];"string"!=typeof f?(u=l*f,n||(n=i-u),i||(i=n+u)):(n||(n=s.subtract(l,r[c]).valueOf()),i||(i=o.add(l,r[c]).valueOf()))}return this.getSingleDateForDateRange(n,i)},this.getSingleDateForDateRange=function(t,e){return new Date(t)},this.quantizeDate=function(t,e){var a=e<=OMHWebVisualizations.DataParser.QUANTIZE_MONTH?t.getMonth():6,n=e<=OMHWebVisualizations.DataParser.QUANTIZE_DAY?t.getDate():e===OMHWebVisualizations.DataParser.QUANTIZE_MONTH?15:1,i=e<=OMHWebVisualizations.DataParser.QUANTIZE_HOUR?t.getHours():e===OMHWebVisualizations.DataParser.QUANTIZE_DAY?12:0,r=e<=OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?t.getMinutes():e===OMHWebVisualizations.DataParser.QUANTIZE_HOUR?30:0,o=e<=OMHWebVisualizations.DataParser.QUANTIZE_SECOND?t.getSeconds():e===OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?30:0,s=e<=OMHWebVisualizations.DataParser.QUANTIZE_MILLISECOND?t.getMilliseconds():e===OMHWebVisualizations.DataParser.QUANTIZE_SECOND?500:0;return new Date(t.getFullYear(),a,n,i,r,o,s)},this.parseOmhData=function(t,e,n){var i=this,r={},o={},s={};return t&&0!==t.length?(e.forEach(function(t,e){o[t]=a.getMeasureSettings(t).data.xValueQuantization.period,s[t]=a.getMeasureSettings(t).data.yValuePath}),t.forEach(function(t){t.groupName="",e.forEach(function(e,a){var l=i.resolveKeyPath(t,s[e]);if(void 0!==l&&"object"!=typeof l){t.groupName+="_"+e,r.hasOwnProperty(e)||(r[e]=[]);var u;t.body.effective_time_frame.date_time&&(u=i.quantizeDate(new Date(t.body.effective_time_frame.date_time),o[e])),t.body.effective_time_frame.time_interval&&(u=i.quantizeDate(i.getIntervalDisplayDate(t,n),o[e])),r[e].push({y:l,x:u,provider:t.header.acquisition_provenance.source_name,omhDatum:t,primary:0===a,measure:e})}})}),e.forEach(function(t,e){o[t]!==OMHWebVisualizations.DataParser.QUANTIZE_NONE&&i.aggregateData(t,r)}),r):r},this.aggregateData=function(t,e){var n=a.getMeasureSettings(t).data.xValueQuantization.aggregator;n(e[t])},this.getMeasureData=function(t){return n[t]},this.getAllMeasureData=function(){return n},this.hasMeasureData=function(t){return n.hasOwnProperty(t)},o.call(this)},a.QUANTIZE_YEAR=6,a.QUANTIZE_MONTH=5,a.QUANTIZE_DAY=4,a.QUANTIZE_HOUR=3,a.QUANTIZE_MINUTE=2,a.QUANTIZE_SECOND=1,a.QUANTIZE_MILLISECOND=0,a.QUANTIZE_NONE=-1,a.aggregators={},a.aggregators.sum=function(t){t.sort(function(t,e){return t.x.getTime()-e.x.getTime()});for(var e=0;e<t.length;e++){for(;e+1<t.length&&t[e+1].x.getTime()===t[e].x.getTime();)t[e].y+=t[e+1].y,t[e].aggregatedData||(t[e].aggregatedData=[t[e].omhDatum]),t[e].aggregatedData.push(t[e+1].omhDatum),t.splice(e+1,1);t[e].aggregationType="sum"}},a.aggregators.mean=function(t){n.DataParser.aggregators.sum(t);for(var e=0;e<t.length;e++){var a=t[e].aggregatedData?t[e].aggregatedData.length:0;a>0&&(t[e].y/=a,t[e].aggregationType="mean")}},a.aggregators.median=function(t){t.sort(function(t,e){return t.x.getTime()-e.x.getTime()});for(var e=0;e<t.length;e++){for(var a=[t[e].y];e+1<t.length&&t[e+1].x.getTime()===t[e].x.getTime();)t[e].aggregatedData||(t[e].aggregatedData=[t[e].omhDatum]),a.push(t[e+1].y),t[e].aggregatedData.push(t[e+1].omhDatum),t.splice(e+1,1);t[e].aggregationType="median",t[e].y=a[parseInt(t[e].aggregatedData.length/2)]}},n.DataParser=a,n}),function(t,e){var a="OMHWebVisualizations";t[a]=e(t,a)}(this,function(t,e){var a,n=t.hasOwnProperty(e)?t[e]:{};return a=function(){},a.mergeObjects=function(t,e){function a(a){if(void 0===i[a]){var r=t[a],o=e[a];typeof r!=typeof o||"object"!=typeof r||o instanceof Array?(i[a]=r,e.hasOwnProperty(a)&&(i[a]=o)):i[a]=n.Utils.mergeObjects(r||{},o||{})}}var i={};for(var r in t)a(r);for(r in e)a(r);return i},n.Utils=a,n});